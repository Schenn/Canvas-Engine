$.fn.createGradient=function(a){if(!this[0].getContext)return null;var b,c,d=this[0].getContext('2d'),e=$.extend({},a),f=0,g=1;for(b=null!==e.r1||null!==e.r2?d.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2):d.createLinearGradient(e.x1,e.y1,e.x2,e.y2);void 0!==e['c'+g];)f+=1,g+=1;for(g=1;f>=g;g+=1)c=Math.round(100/(f-1)*(g-1))/100,void 0===e['s'+g]&&(e['s'+g]=c),b.addColorStop(e['s'+g],e['c'+g]);return b},$.fn.pattern=function(a){function b(){return h.complete?(e=f.createPattern(h,g.repeat),!0):!1}function c(){g.load&&g.load.call(this[0],e)}function d(){b(),c()}if(!this[0].getContext)return null;var e,f=this[0].getContext('2d'),g=$.extend({},a),h=new Image;return g.source.src?h=g.source:g.source&&(h.src=g.source),!h.complete&&g.load?h.onload=d:b()?c():h.onload=d,e},$.fn.getCanvasImage=function(a){return this[0].toDataURL?(a=void 0===a?'image/png':a.replace(/^([a-z]+)$/gi,'image/$1').replace(/jpg/gi,'jpeg'),this[0].toDataURL(a)):null},function(a){a.fn.getEnhancedContext=function(){var b=a(this)[0].getContext('2d'),c=a(this)[0],d={};return d.setDefaults=function(a){b.fillStyle=a.fillStyle,b.strokeStyle=a.strokeStyle,b.lineWidth=a.strokeWidth,a.rounded?(b.lineCap='round',b.lineJoin='round'):(b.lineCap=a.strokeCap,b.lineJoin=a.strokeJoin),b.shadowOffsetX=a.shadowX,b.shadowOffsetY=a.shadowY,b.shadowBlur=a.shadowBlur,b.shadowColor=a.shadowColor,b.globalAlpha=a.opacity,b.globalCompositeOperation=a.compositing},d.clear=function(a){a.width||a.height?this.fromCenter?b.clearRect(a.x-a.width/2,a.y-a.height/2,a.width,a.height):b.clearRect(a.x,a.y,a.width,a.height):b.clearRect(0,0,c.width,c.height)},d.closePath=function(a){a.mask&&(b.save(),b.clip()),a.closed?(b.closePath(),b.fill(),b.stroke()):(b.fill(),b.stroke(),b.closePath())},d.convertAngles=function(a){return a.inDegrees?Math.PI/180:1},d.positionShape=function(a,c,d){a.toRad=this.convertAngles(a),b.save(),a.fromCenter||(a.x+=c/2,a.y+=d/2),a.angle&&(b.translate(a.x,a.y),b.rotate(a.angle*a.toRad),b.translate(-a.x,-a.y))},d.drawArc=function(a){var c=Math.PI;a.inDegrees||360!==a.end||(a.end=2*c),this.positionShape(b,a,2*a.radius,2*a.radius),b.beginPath(),b.arc(a.x,a.y,a.radius,a.start*a.toRad-c/2,a.end*a.toRad-c/2,a.ccw),b.restore(),this.closePath(b,a)},d.drawBezier=function(a){var c,d,e,f,g,h,i=2,j=1;for(this.setDefaults(a),b.beginPath(),b.moveTo(a.x1,a.y1);;){if(c=a['x'+i],d=a['y'+i],e=a['cx'+j],f=a['cy'+j],g=a['cx'+(j+1)],h=a['cy'+(j+1)],void 0===c||void 0===d||void 0===e||void 0===f||void 0===g||void 0===h)break;b.bezierCurveTo(e,f,g,h,c,d),i+=1,j+=2}this.closePath(b,a)},d.drawEllipse=function(a){var c=4*a.width/3;this.setDefaults(a),this.positionShape(a,a.width,a.height),b.beginPath(),b.moveTo(a.x,a.y-a.height/2),b.bezierCurveTo(a.x-c/2,a.y-a.height/2,a.x-c/2,a.y+a.height/2,a.x,a.y+a.height/2),b.bezierCurveTo(a.x+c/2,a.y+a.height/2,a.x+c/2,a.y-a.height/2,a.x,a.y-a.height/2),b.restore(),this.closePath(b,a)},d.drawImage=function(a){function c(){return h.complete?(g=h.width/h.height,a.sWidth=a.sWidth||h.width,a.sHeight=a.sHeight||h.height,a.sWidth>h.width&&(a.sWidth=h.width),a.sHeight>h.height&&(a.sHeight=h.height),0===a.width&&a.sWidth!==h.width&&(a.width=a.sWidth),0===a.height&&a.sHeight!==h.height&&(a.height=a.sHeight),null===a.sx&&(a.cropFromCenter?a.sx=h.width/2:a.sx=0),null===a.sy&&(a.cropFromCenter?a.sy=h.height/2:a.sy=0),a.cropFromCenter||(a.sx+=a.sWidth/2,a.sy+=a.sHeight/2),a.sx-a.sWidth/2<0&&(a.sx=a.sWidth/2),a.sx+a.sWidth/2>h.width&&(a.sx=h.width-a.sWidth/2),a.sy-a.sHeight/2<0&&(a.sy=a.sHeight/2),a.sy+a.sHeight/2>h.height&&(a.sy=h.height-a.sHeight/2),a.width&&!a.height?a.height=a.width/g:!a.width&&a.height?a.width=a.height*g:a.width||a.height||(a.width=h.width,a.height=h.height),d.positionShape(a,a.width,a.height),b.drawImage(h,a.sx-a.sWidth/2,a.sy-a.sHeight/2,a.sWidth,a.sHeight,a.x-a.width/2,a.y-a.height/2,a.width,a.height),b.restore(),!0):!1}function e(){"function"==typeof a.load&&a.load.call(d)}function f(){c(),e()}var g,h=new Image;a.source.src?h=a.source:a.source&&(h.src=a.source),!h.complete&&a.load?h.onload=f:c()?e():h.onload=f},d.drawLine=function(a){var c,d,e=2;for(b.beginPath(),b.moveTo(a.x1,a.y1);;){if(c=a['x'+e],d=a['y'+e],void 0===c||void 0===d)break;b.lineTo(c,d),e+=1}this.closePath(a)},d.drawQuad=function(a){var c,d,e,f,g=2;for(b.beginPath(),b.moveTo(a.x1,a.y1);;){if(c=a['x'+g],d=a['y'+g],e=a['cx'+(g-1)],f=a['cy'+(g-1)],void 0===c||void 0===d||void 0===e||void 0===f)break;b.quadraticCurveTo(e,f,c,d),g+=1}this.closePath(a)},d.drawRect=function(a){var c,d,e,f,g,h=Math.PI;this.setDefaults(a),this.positionShape(a,a.width,a.height),b.beginPath(),a.cornerRadius?(a.closed=!0,c=a.x-a.width/2,d=a.y-a.height/2,e=a.x+a.width/2,f=a.y+a.height/2,g=a.cornerRadius,0>e-c-2*g&&(g=(e-c)/2),0>f-d-2*g&&(g=(f-d)/2),b.moveTo(c+g,d),b.lineTo(e-g,d),b.arc(e-g,d+g,g,3*h/2,2*h,!1),b.lineTo(e,f-g),b.arc(e-g,f-g,g,0,h/2,!1),b.lineTo(c+g,f),b.arc(c+g,f-g,g,h/2,h,!1),b.lineTo(c,d+g),b.arc(c+g,d+g,g,h,3*h/2,!1)):b.rect(a.x-a.width/2,a.y-a.height/2,a.width,a.height),b.restore(),this.closePath(a)},d.drawText=function(a){return b.textBaseline=a.baseline,b.textAlign=a.align,b.font=a.font,b.strokeText(a.text,a.x,a.y),b.fillText(a.text,a.x,a.y),this},d.draw=function(a){a(b)},d.restore=function(){b.restore()},d.rotate=function(a){this.positionShape(a,0,0)},d.save=function(){b.save()},d.translate=function(a){b.save(),b.translate(a.x,a.y)},d.scale=function(a){b.save(),b.translate(a.x,a.y),b.scale(a.scaleX,a.scaleY),b.translate(-a.x,-a.y)},d.setPixels=function(a){var d,e,f,g,h={};if(a.x||a.y||a.width||a.height||(a.width=c.width,a.height=c.height,a.x=a.width/2,a.y=a.height/2),this.positionShape(a,a.width,a.height),e=b.getImageData(a.x-a.width/2,a.y-a.height/2,a.width,a.height),f=e.data,g=f.length,void 0!==a.each)for(d=0;g>d;d+=4)h.index=d/4,h.r=f[d],h.g=f[d+1],h.b=f[d+2],h.a=f[d+3],a.each.call(c,h),f[d]=h.r,f[d+1]=h.g,f[d+2]=h.b,f[d+3]=h.a;b.putImageData(e,a.x-a.width/2,a.y-a.height/2),b.restore()},d.measureText=function(a){return b.font=a.font,b.measureText(a.text)},d.atPixel=function(a,c,d,e,f){var g=b.getImageData(a,c,e,d),h=g.data;if(f){for(var i=3;i<h.length;i+=4)if(h[i]>0)return!0;return!1}return h},d}}(jQuery),function(a){a.fn.maximize=function(a){a='undefined'!=typeof a?a/100:1;var b=parseInt(this.parent().height())*a,c=parseInt(this.parent().width())*a;this.attr("height",b).attr("width",c)}}(jQuery),function(a){a.fn.addZLayer=function(b,c,d){var e='zLayer'+d,f=a("<canvas id='"+e+"'></canvas>");return f.appendTo(this.parent()),f.attr("height",b).attr("width",c).css("z-index",d),f}}(jQuery);var CanvasEngine={paused:!0};CanvasEngine.addMap=function(a,b){var c=this.EntityManager.fromMap(a);this.addEntities(c,b)},CanvasEngine.addEntities=function(a,b){$.each(a,function(a){CanvasEngine.Screen.addZLayer(a)}),this.EntityTracker.addEntities(a),b&&(this.paused=!1,this.Loop())},CanvasEngine.Loop=function(){requestAnimationFrame(function(){CanvasEngine.Screen.drawScreen(),CanvasEngine.Loop()})},CanvasEngine.drawZ=function(a,b){!this.paused&&CanvasEngine.EntityTracker.entityCount()>0&&$.each(this.EntityTracker.getEntitiesByZ(a),function(a,c){CanvasEngine.utilities.exists(c)&&(c.broadcastToComponents("update"),c.getFromComponent("Renderer","isDirty")&&(c.messageToComponent("Renderer","clear",b),c.messageToComponent("Renderer","render",b)),c.broadcastToComponents("postRender"))})},CanvasEngine.clearEntities=function(){this.paused=!0,CanvasEngine.EntityTracker.clearEntities(),this.paused=!1},CanvasEngine.checkClickMap=function(a){var b=CanvasEngine.positionsAtPixel(a,1,1);$.each(b,function(b,c){c.broadcastToComponents("Click",a)})},CanvasEngine.pause=function(){this.paused=!this.paused},CanvasEngine.positionsAtPixel=function(a,b,c){var d=CanvasEngine.Screen.atPixel(a.x,a.y,c,b,!0);return d.length>0?CanvasEngine.EntityTracker.positionsAtPixel(a,b,c,Object.keys(d)):[]},CanvasEngine.setup=function(a,b,c){CanvasEngine.Screen.setScreen(a),this.addMap(b,c)},function(){function a(a){return{enumerable:!0,writable:!1,configurable:!1,value:a}}function b(a,b){return{enumerable:!0,configurable:!1,get:function(){return a},set:function(c){"number"==typeof a?c=Number(c):"string"==typeof a?c=c.toString():"boolean"==typeof a&&(c=Boolean(c)),a=c,CanvasEngine.utilities.isFunction(b)&&b(c)}}}var c=function(){var c,d,e={},f={},g=[],h={};this.properties={lockedProperty:a,defaultProperty:b},this.setBaseEntityGenerator=function(a){c=a,d=a({})},this.isEntity=function(a){return d instanceof a},this.create=function(a,b){var d=function(a){return e[a](c(b),b)};CanvasEngine.utilities.exists(b.image)&&(b.image=CanvasEngine.ResourceManager.getImage(b.image)),CanvasEngine.utilities.exists(b.spritesheet)&&"string"==typeof b.spritesheet?b.spritesheet=CanvasEngine.ResourceManager.getSpriteSheet(b.spritesheet):CanvasEngine.utilities.exists(b.spritesheets)&&$.each(b.spritesheets,function(a,c){'string'==typeof c&&(b.spritesheets[a]=CanvasEngine.ResourceManager.getSpriteSheet(c))}),CanvasEngine.utilities.exists(b.z_index)||(b.z_index=CanvasEngine.EntityTracker.maxZ());var f;return f=CanvasEngine.utilities.exists(h[a])?e[a](this.create(h[a],b),b):d(a),CanvasEngine.utilities.exists(b.onClick)&&this.attachComponent(f,"Click",b),f},this.setMake=function(a,b,c){return-1===Object.keys(e).indexOf(a)&&(e[a]=b),CanvasEngine.utilities.exists(c)&&(h[a]=c),this},this.addComponent=function(a,b,c){return-1===Object.keys(f).indexOf(a)&&(f[a]=b),c&&g.push(a),this},this.attachComponent=function(a,b,c){if("string"==$.type(b))-1!=Object.keys(f).indexOf(b)&&a.attachComponent(b,f[b](c,a));else if("object"==$.type(b))for(var d=Object.keys(b),e=0;e<d.length;e++){var h=d[e];if("object"==$.type(b[h]))for(var i=Object.keys(b[h]),j=0;j<i.length;j++)a.attachComponent(i[j],f[h](b[h][i[j]],a));else if("string"==$.type(b[h])){var k=b[k];-1!=Object.keys(f).indexOf(h)&&g.indexOf(h)>-1&&a.attachComponent(k,f[h](c,a))}}return this},this.fromMap=function(a){var b=[];return $.each(a,function(a,c){var d=CanvasEngine.EntityManager.create(c.type,c);CanvasEngine.utilities.exists(b[d.z_index])||(b[d.z_index]=[]),b[d.z_index].push(d)}),b}};CanvasEngine.EntityManager=new c}(),function(){var a=function(){var a={},b=[],c=[],d=0;this.addEntities=function(c){$.each(c,function(c,e){$.each(e,function(e,f){a[f.name]=f,CanvasEngine.utilities.exists(b[c])||(b[c]=[],d=c),b[c].push(f.name)})})},this.excludeZ=function(a,b){a.forEach(function(a){b?delete c[a]:c[a]=!0})},this.getEntities=function(b){var c=[];return $.each(b,function(b,d){c[b]=a[d]}),c},this.removeEntities=function(c){$.each(c,function(c,e){CanvasEngine.Screen.clear(a[e]);var f=a[e].z_index,g=-1;b[f].forEach(function(a,b){a===e&&(g=b)}),g>=0&&(delete b[f][g],b[f]=CanvasEngine.utilities.cleanArray(b[f])),0===b[f].length&&(CanvasEngine.Screen.removeZLayer(f),delete b[f],b=CanvasEngine.utilities.cleanArray(b),d=Object.keys(b)[-1]),delete a[e]})},this.clearEntities=function(){for(var a=Object.keys(b),c=a.length-1;c>=0;c--)this.removeEntities(b[a[c]])},this.getEntitiesByZ=function(c){var d=[];return $.each(b[c],function(b,c){d.push(a[c])}),d},this.positionsAtPixel=function(a,b,d,e){for(var f=[],g=0;g<e.length;g++){var h=e[g];if(!c[h])for(var i=this.getEntitiesByZ(h),j=0;j<i.length;j++)i[j].getFromComponent("Renderer","containsPixel",a)&&f.push(i[j])}return f},this.maxZ=function(){return d},this.entityCount=function(){return Object.keys(a).length}};CanvasEngine.EntityTracker=new a}(),function(){var a,b=(CanvasEngine.utilities,{}),c={},d={},e="",f={},g=!1,h=function(){this.Resources={},this.setImagePath=function(a){e=a},this.addSound=function(a,b){},this.addImage=function(a,b,d){var g=new Image;c[a]=g,f[a]=!1;var h=this,i=function(){h.resourcesAreLoaded()&&f[a]===!0&&h.triggerCallback()};g.addEventListener("load",function(){f[a]=!0,i()}),g.addEventListener("load",d),g.src=e+"/"+b,g.complete&&(CanvasEngine.utilities.isFunction(d)&&d(g),i())},this.addSpriteSheet=function(a,b,e){d[a]=new this.Resources.SpriteSheet(e),f[a+"sheet"]=!1,this.addImage(a,b,function(b){d[a].processSprites(c[a]),f[a+"sheet"]=!0,CanvasEngine.ResourceManager.triggerCallback()})},this.getSpriteSheet=function(a){return d[a]},this.getImage=function(a){return image[a]},this.getSound=function(a){return b[a]},this.resourcesAreLoaded=function(){if(g){for(var a=Object.keys(f),b=0;b<a.length;b++)if(f[a[b]]===!1)return!1;return!0}},this.finishedAddingResources=function(){g=!0},this.onResourcesLoaded=function(b){a=b},this.triggerCallback=function(){this.resourcesAreLoaded()&&CanvasEngine.utilities.isFunction(a)&&a()},this.loadResourceCollection=function(a,b){this.onResourcesLoaded(b);for(var c=0;c<a.length;c++){var d=Object.keys(a[c])[0],e=a[c][d];switch(d.toLowerCase()){case"spritesheet":this.addSpriteSheet(e.name,e.source,e.details);break;case"image":this.addImage(e.name,e.source,e.details);break;case"sound":this.addSound(e.name,e.source,e.details)}}this.finishedAddingResources()}};CanvasEngine.ResourceManager=new h}(),function(){var a=function(){var a,b=[];this.height=function(){return a.height()},this.width=function(){return a.width()},this.setScreen=function(c){c instanceof jQuery||(c=$(c)),b[0]=c,a=c,a.on("click",this.onClick)},this.maximize=function(a){b.forEach(function(b){b.maximize(a)})},this.addZLayer=function(c){if(!CanvasEngine.utilities.exists(b[c])){var d=a.addZLayer(a.attr("height"),a.attr("width"),c);d.on("click",this.onClick),b[c]=d}},this.removeZLayer=function(a){a>0&&(b[a].remove(),delete b[a],b=CanvasEngine.utilities.cleanArray(b))},this.drawScreen=function(){b.forEach(function(a,b){var c=a.getEnhancedContext();CanvasEngine.drawZ(b,c)})},this.clear=function(a){var c=b[a.z_index].getEnhancedContext();a.messageToComponent("Renderer","clear",c)},this.atPixel=function(a,c,d,e,f){var g=[],h=Object.keys(b);return $.each(h,function(h,i){b[i].getEnhancedContext().atPixel(a,c,d,e,f)&&(g[i]=!0)}),g},this.onClick=function(a){a.stopPropagation(),a.cancelBubble=!0;var b={x:a.offsetX,y:a.offsetY};CanvasEngine.checkClickMap(b)}};CanvasEngine.Screen=new a}(),function(){var a={};a.exists=function(a){return"undefined"!=typeof a&&null!==a},a.orDefault=function(a,b){return this.exists(a)?a:b},a.isFunction=function(a){return this.exists(a)&&$.isFunction(a)},a.isArray=function(a){return!!a&&a.constructor===Array},a.convertAngles=function(a){return a.inDegrees?Math.PI/180:1},a.cleanArray=function(a){for(var b=[],c=0;c<a.length;c++)this.exists(a[c])&&b.push(a[c]);return b},a.randName=function(){for(var a=8+Math.floor(7*(Math.random()%1)),b="ce_",c=1;a>=c;c++){var d=1+Math.floor(4*(Math.random()%1));switch(d){case 1:b+=48+Math.floor(10*(Math.random()%1));break;case 2:b+=String.fromCharCode(65+Math.floor(26*(Math.random()%1)));break;case 3:b+=String.fromCharCode(97+Math.floor(26*(Math.random()%1)))}}return b},a.parseJsonArray=function(a){"string"==typeof a&&(a=$.parseJSON(a));for(var b=0;b<a.length;b++)null!==$.parseJSON(a[b])&&(a[b]=$.parseJSON(a[b]));return a},a.setProperties=function(a,b){Object.keys(b).forEach(function(c){a.hasOwnProperty(c)&&(a[c]=b[c])})},CanvasEngine.utilities=a}(),function(){var a=CanvasEngine.utilities;CanvasEngine.ResourceManager.Resources.SpriteSheet=function(b){var c,d,e=b.height,f=b.width,g=[];"undefined"!=typeof b.sprites&&(c=b.sprites);var h=function(){for(var b=0,h=0,i=0,j=a.exists(c);h<d.height;){for(;b<d.width;){var k=j?c[i]:i;g[k]={x:b,y:h,width:f,height:e},b+=f,i++}h+=e,b=0}},i=function(){$.each(c,function(a,b){g[a]=$.extend({},{width:f,height:e},b)})};this.processSprites=function(b){d=b,a.exists(c)&&Object.keys(c).length>0&&!a.isArray(c)?i():h(),this.spritesLoaded=!0},this.getSprite=function(a){return g[a]},this.sHeight=function(){return e},this.sWidth=function(){return f},this.source=function(){return d}}}(),function(){var a=CanvasEngine.EntityManager,b=CanvasEngine.utilities;a.setMake("ASPRITE",function(c,d){var e={},f="default";return c.setCurrentAnimation=function(a){b.exists(e[a])&&(c.messageToSubEntity(f,"disable"),f=a,c.messageToSubEntity(f,"enable"))},c.addAnimation=function(b,d){var g=a.create("Animator",$.extend({},{name:b,onFrameChange:function(a){f===b&&c.setSprite(a)}},d));"default"!==b&&g.disable(),e[b]=!0,c.attachSubEntity(g)},$.each(d.animations,function(a,b){c.addAnimation(a,b)}),c},"SPRITE")}(),function(){var a=CanvasEngine.EntityManager,b=CanvasEngine.utilities;a.setMake("Animator",function(c,d){var e,f,g,h,i=0,j=d.onFrameChange;if(b.exists(d.frames))e=d.frames,h=e.length;else{h=b.exists(d.frameCount)?d.frameCount:1,e=[];for(var k=0;h>k;k++)e.push(k)}return f=d.duration,g=f>0?f/h:0,c.disable=function(){c.messageToComponent("Timer","disable")},c.enable=function(){c.messageToComponent("Timer","enable")},a.attachComponent(c,"Timer",{duration:g,onElapsed:function(){i++,i>h-1&&(i=0),j(e[i])}}),c})}(),function(){var a=CanvasEngine.EntityManager,b=CanvasEngine.utilities;a.setMake("Button",function(c,d){var e;return e=b.exists(d.spritesheet)?a.create("SPRITE",$.extend({},{fromCenter:!0},d.background)):b.exists(d.source)?a.create("IMAGE",$.extend({},{fromCenter:!0},d.source)):a.create("RECT",$.extend({},{fromCenter:!0},d.background)),a.attachComponent(c,"Text",$.extend({},{callback:function(){c.messageToComponent("Renderer","markDirty")}},d)),a.attachComponent(c,"Renderer",$.extend({clearInfo:function(a){return e.getFromComponent("Renderer","clearInfo",a)},draw:function(a){var b=c.getFromComponent("Text","asObject"),f={width:a.measureText({font:b.font,text:b.text}).width+4,height:a.measureText({font:b.font,text:"MWO"}).width/3+4};f.width+=2*d.padding,f.height+=2*d.padding,e.messageToComponent("Renderer","setPosition",{x:this.x}),e.messageToComponent("Renderer","setPosition",{y:this.y}),e.messageToComponent("Renderer","resize",f),this.resize(f),e.messageToComponent("Renderer","render",a),a.setDefaults(this),a.drawText($.extend({},this,c.getFromComponent("Text","asObject")))}},{x:d.x,y:d.y,fillStyle:d.fillStyle})),c})}(),function(){function a(a){var d={},e={};Object.defineProperties(this,{z_index:b.properties.lockedProperty(a.z_index||0),name:b.properties.lockedProperty(a.name||c.randName())}),a.hasOwnProperty("z_index")&&delete a.z_index,this.attachComponent=function(a,b){this.hasComponent(a)||(d[a]=b)},this.attachSubEntity=function(a){e[a.name]=a},this.hasComponent=function(a){return Object.keys(d).indexOf(a)>-1},this.broadcastToComponents=function(a,b){$.each(d,function(d,e){c.isFunction(e[a])&&e[a].call(e,b)}),$.each(e,function(c,d){d.broadcastToComponents(a,b)})},this.messageToComponent=function(a,b,e){c.exists(d[a])&&c.isFunction(d[a][b])&&(c.exists(e)?d[a][b].call(d[a],e):d[a][b].call(d[a]))},this.getFromComponent=function(a,b,e){return c.exists(d[a])&&c.isFunction(d[a][b])?c.exists(e)?d[a][b].call(d[a],e):d[a][b].call(d[a]):void 0},this.messageToSubEntity=function(a,b,d){c.exists(e[a])&&c.isFunction(e[a][b])&&(c.exists(d)?e[a][b].call(e[a],d):e[a][b].call(e[a]))},this.getComponentList=function(){return $.extend({},d)}}var b=CanvasEngine.EntityManager,c=CanvasEngine.utilities;b.setBaseEntityGenerator(function(b){return new a(b)})}(),function(){var a=CanvasEngine.EntityManager;a.setMake("IMAGE",function(b,c){return a.attachComponent(b,"Image",$.extend({},c,{callback:function(){b.messageToComponent("Renderer","markDirty")}})),a.attachComponent(b,"Renderer",$.extend({},c,{draw:function(a){a.drawImage($.extend({},this,b.getFromComponent("Image","asObject")))}})),b})}(),function(){var a=CanvasEngine.EntityManager;CanvasEngine.utilities;a.setMake("LABEL",function(b,c){return a.attachComponent(b,"Text",$.extend({},{callback:function(){b.messageToComponent("Renderer","markDirty")}},c)),a.attachComponent(b,"Renderer",$.extend({},{fillStyle:"#fff",clearInfo:function(a){var c,d,e=this.x-1,f=this.y-1,g=b.getFromComponent("Text","asObject");switch(c=a.measureText({font:g.font,text:g.text}).width+4,d=a.measureText({font:g.font,text:"MWO"}).width/3+4,g.align){case"right":e+=c;break;case"center":e-=c/2}switch(g.baseline){case"middle":f-=d/2;break;case"bottom":f+=d/2}return{x:e,y:f,height:d,width:c,fromCenter:!1}},draw:function(a){a.drawText($.extend({},this,b.getFromComponent("Text","asObject")))}},c)),b})}(),function(){var a=CanvasEngine.EntityManager,b=CanvasEngine.utilities;a.setMake("LINE",function(c,d){return a.attachComponent(c,"Renderer",{strokeStyle:b.exists(d.strokeStyle)?d.strokeStyle:"#000000",strokeCap:b.exists(d.strokeCap)?d.strokeCap:"round",strokeJoin:b.exists(d.strokeJoin)?d.strokeJoin:"miter",strokeWidth:b.exists(d.strokeWidth)?d.strokeWidth:10,rounded:b.exists(d.rounded)?d.rounded:!1,draw:function(a){a.drawLine($.extend({},this,c.getFromComponent("PointPlotter","getCoordinatesAsObject")))},clearInfo:function(){return $.extend({},c.getFromComponent("PointPlotter","getArea"),{fromCenter:!1})}}),a.attachComponent(c,"PointPlotter",{callback:function(){c.messageToComponent("Renderer","markDirty")}}),c.plot=function(a){c.messageToComponent("PointPlotter","plot",a)},c})}(),function(){var a=CanvasEngine.EntityManager,b=CanvasEngine.utilities;a.setMake("MSPRITE",function(c,d){function e(a,d){var e={};e[a]=d,c.messageToComponent("Renderer","setPosition",e),b.isFunction(c.onMovement)&&c.onMovement.call(c,e)}return b.isFunction(d.onMovement)&&(c.onMovement=d.onMovement.bind(c)),a.attachComponent(c,"Movement",$.extend({},{onDirectionChange:function(a){c.onDirectionChange(a)},onMoveX:function(a){e("x",a)},onMoveY:function(a){e("y",a)}},d)),c.onDirectionChange=b.isFunction(d.onDirectionChange)?d.onDirectionChange:function(a){c.setCurrentAnimation(a.direction)},a.attachComponent(c,$.extend({},{Timer:{movementTimer:$.extend({},{onUpdate:function(a){c.messageToComponent("Movement","move",a)}},d.movementTimer)}})),c},"ASPRITE")}(),function(){var a=CanvasEngine.EntityManager,b=CanvasEngine.utilities;a.setMake("RECT",function(c,d){return a.attachComponent(c,"Renderer",{fromCenter:b.exists(d.fromCenter)?d.fromCenter:!1,height:b.exists(d.height)?d.height:100,width:b.exists(d.width)?d.width:100,fillStyle:b.exists(d.fillStyle)?d.fillStyle:"#000000",draw:function(a){a.drawRect(this)}}),c})}(),function(){var a=CanvasEngine.EntityManager,b=CanvasEngine.utilities;a.setMake("SPRITE",function(c,d){var e,f="default";return a.attachComponent(c,"Renderer",$.extend({},{draw:function(a){a.drawImage($.extend({},this,c.getFromComponent(f+"Image","asObject")))}},d)),$.each(Object.keys(d.spritesheets),function(b,e){var f={};f[e+"Image"]={source:d.spritesheets[e].source(),height:d.height,width:d.width,callback:function(){c.messageToComponent("Renderer","markDirty")}};var g={};g[e+"Sheet"]={spritesheet:d.spritesheets[e]},a.attachComponent(c,$.extend({},{Image:f,SpriteSheet:g}))}),c.setSprite=function(a){e=a,c.messageToComponent(f+"Image","setSprite",c.getFromComponent(f+"Sheet","getSprite",a))},c.setCurrentSheet=function(a){f=a},c.setSprite(b.exists(d.defaultSprite)?d.defaultSprite:0),c})}(),function(){var a=CanvasEngine.EntityManager,b=CanvasEngine.utilities;a.setMake("TILEMAP",function(c,d){if(a.attachComponent(c,"SpriteSheet",d),a.attachComponent(c,"TileMap",$.extend({},{onScroll:function(){c.messageToComponent("Renderer","markDirty")}},d.tileMap)),a.attachComponent(c,"Renderer",$.extend({},{draw:function(a){for(var b=c.getFromComponent("TileMap","getVisibleTiles",{width:CanvasEngine.Screen.width(),height:CanvasEngine.Screen.height()}),d=c.getFromComponent("TileMap","getTileSize"),e=0;e<b.length;e++)for(var f=0;f<b[e].length;f++){var g=b[e][f],h=c.getFromComponent("SpriteSheet","getSprite",g),i=c.getFromComponent("SpriteSheet","source"),j=$.extend({},{x:f*d.width,y:e*d.height,source:i,sx:h.x,sy:h.y,sHeight:h.height,sWidth:h.width,height:d.height,width:d.width});a.drawImage(j)}},clearInfo:function(a){return{x:0,y:0,height:CanvasEngine.Screen.height(),width:CanvasEngine.Screen.width()}}},d)),b.isFunction(d.tileMap.onTileClick)){var e=function(a){c.messageToComponent("TileMap","TileClick",a)};c.hasComponent("Click")?c.messageToComponent("Click","addClickMethods",e):a.attachComponent(c,"Click",$.extend({},{onClick:e}))}return c.scroll=function(a){c.messageToComponent("TileMap","scroll",a)},c.setTileAt=function(a,b){c.messageToComponent("TileMap","setTile",{coord:a,val:b}),c.messageToComponent("Renderer","markDirty")},c})}(),function(){var a=function(a,b){var c=[];CanvasEngine.utilities.isFunction(a.onClick)?c.push(a.onClick):Array.isArray(a.onClick)&&(c=c.concat(a.onClick)),this.getEntity=function(){return b},this.Click=function(a){$.each(c,function(c,d){d.call(b,a)})},this.addClickMethods=function(a){c=c.concat(a)}};CanvasEngine.EntityManager.addComponent("Click",function(b,c){return new a(b,c)},!0)}(),function(){var a=CanvasEngine.EntityManager.properties,b=function(b,c){var d=b.source,e=0,f=0,g=0,h=0,i=CanvasEngine.utilities.exists(b.cropFromCenter)?b.cropFromCenter:!1;Object.defineProperties(this,{source:a.lockedProperty(d),sx:a.defaultProperty(e,b.callback),sy:a.defaultProperty(f,b.callback),sWidth:a.defaultProperty(g,b.callback),sHeight:a.defaultProperty(h,b.callback),cropFromCenter:a.defaultProperty(i,b.callback)}),this.getEntity=function(){return c},this.asObject=function(){return this.sWidth>0&&this.sHeight>0?$.extend({},this):{source:this.source}},this.setSprite=function(a){this.sx=a.x,this.sy=a.y,this.sWidth=a.width,this.sHeight=a.height}};CanvasEngine.EntityManager.addComponent("Image",function(a,c){return new b(a,c)},!0)}(),function(){var a=CanvasEngine.EntityManager.properties,b=CanvasEngine.utilities,c=function(c,d){var e,f=c.x,g=c.y,h=b.exists(c.xSpeed)?c.xSpeed:0,i=b.exists(c.ySpeed)?c.ySpeed:0;b.isFunction(c.onDirectionChange)&&(this.onDirectionChange=c.onDirectionChange.bind(this)),Object.defineProperties(this,{x:a.defaultProperty(f,c.onMoveX),y:a.defaultProperty(g,c.onMoveY)}),this.move=function(a){if(a>0?(this.x+=h>0?h*a:0,this.y+=i>0?i*a:0):(this.x+=h>0?h:0,this.y+=i>0?i:0),this.getDirection().direction!==e&&b.isFunction(this.onDirectionChange)){var c=this.getDirection();this.onDirectionChange(c),e=c.direction}},this.setSpeed=function(a){h=b.exists(a.xSpeed)?a.xSpeed:h,i=b.exists(a.ySpeed)?a.ySpeed:i},this.setOrigin=function(a){this.x=a.x,this.y=a.y},this.getEntity=function(){return d},this.asObject=function(){return $.extend({},{x:this.x,y:this.y,xSpeed:h,ySpeed:i})},this.getDirection=function(){var a="";return a+=i>0?"S":"N",0!==h&&(a+=h>0?"E":"W"),{direction:a,xSpeed:h,ySpeed:i}}};CanvasEngine.EntityManager.addComponent("Movement",function(a,b){return new c(a,b)},!0)}(),function(){var a=CanvasEngine.EntityManager.properties,b=function(b,c){var d=[],e={};Object.defineProperty(this,"coords",a.defaultProperty(e)),this.plot=function(c){d=c;for(var f=1;f<=c.length;f++)e.hasOwnProperty("x"+f)?e["x"+f]=c[f-1].x:Object.defineProperty(e,"x"+f,a.defaultProperty(c[f-1].x,b.callback)),e.hasOwnProperty("y"+f)?e["y"+f]=c[f-1].y:Object.defineProperty(e,"y"+f,a.defaultProperty(c[f-1].y,b.callback))},this.getArea=function(){for(var a=0,b=0,c=0,e=0,f=0;f<d.length;f++)d[f].x<=a&&(a=d[f].x),d[f].y<=a&&(b=d[f].y),d[f].x>=c&&(c=d[f].x),d[f].y>=e&&(e=d[f].y);return{x:a,y:b,width:c-a,height:e-b}},CanvasEngine.utilities.exists(b.coords)&&this.plot(b.coords),this.getEntity=function(){return c},this.getCoordinatesAsArray=function(){return d},this.getCoordinatesAsObject=function(){return e}};CanvasEngine.EntityManager.addComponent("PointPlotter",function(a,c){return new b(a,c)},!0)}(),function(){var a=CanvasEngine.EntityManager.properties,b=function(b,c){var d,e=this,f=!0;this.markDirty=function(){f=!0};var g='center',h=0,i='middle',j=!1,k=!1,l='source-over',m=0,n=360,o="#000",p=!1,q=0,r=!0,s=!1,t=1,u=0,v=null,w=null,x=0,y='repeat',z=!1,A=1,B=1,C=3,D='transparent',E=0,F=0,G=3,H=0,I='butt',J='miter',K='transparent',L=1,M=0,N=0,O=0;return Object.defineProperties(e,{textAlign:a.defaultProperty(g,this.markDirty),angle:a.defaultProperty(h,this.markDirty),baseline:a.defaultProperty(i,this.markDirty),ccw:a.defaultProperty(j,this.markDirty),closed:a.defaultProperty(k,this.markDirty),compositing:a.defaultProperty(l,this.markDirty),cornerRadius:a.defaultProperty(m,this.markDirty),end:a.defaultProperty(n,this.markDirty),fillStyle:a.defaultProperty(o,this.markDirty),fromCenter:a.defaultProperty(p,this.markDirty),height:a.defaultProperty(q,this.markDirty),inDegrees:a.defaultProperty(r,this.markDirty),mask:a.defaultProperty(s,this.markDirty),opacity:a.defaultProperty(t,this.markDirty),projection:a.defaultProperty(u,this.markDirty),r1:a.defaultProperty(v,this.markDirty),r2:a.defaultProperty(w,this.markDirty),radius:a.defaultProperty(x,this.markDirty),repeat:a.defaultProperty(y,this.markDirty),rounded:a.defaultProperty(z,this.markDirty),scaleX:a.defaultProperty(A,this.markDirty),scaleY:a.defaultProperty(B,this.markDirty),shadowBlur:a.defaultProperty(C,this.markDirty),shadowColor:a.defaultProperty(D,this.markDirty),shadowX:a.defaultProperty(E,this.markDirty),shadowY:a.defaultProperty(F,this.markDirty),sides:a.defaultProperty(G,this.markDirty),start:a.defaultProperty(H,this.markDirty),strokeCap:a.defaultProperty(I,this.markDirty),strokeJoin:a.defaultProperty(J,this.markDirty),strokeStyle:a.defaultProperty(K,this.markDirty),strokeWidth:a.defaultProperty(L,this.markDirty),width:a.defaultProperty(M,this.markDirty),x:a.defaultProperty(N,this.markDirty),y:a.defaultProperty(O,this.markDirty)}),b.hasOwnProperty("source")&&delete b.source,b.hasOwnProperty("z_index")&&delete b.z_index,CanvasEngine.utilities.isFunction(b.draw)?(this.draw=b.draw,delete b.draw,this.draw.bind(this),CanvasEngine.utilities.exists(b.clearInfo)?(this.clearInfo=b.clearInfo,delete b.clearInfo,this.clearInfo.bind(this)):this.clearInfo=function(){return{x:this.x,y:this.y,height:this.height,width:this.width,fromCenter:this.fromCenter}},this.render=function(a){a.setDefaults(this),this.draw(a),f=!1,d=this.clearInfo(a)},this.clear=function(a){CanvasEngine.utilities.exists(d)||(d=this.clearInfo(a)),a.clear(d)},this.containsPixel=function(a){var b=e.x,c=e.x,d=e.y,f=e.y;return p?(b-=.5*e.width,c+=.5*e.width,d-=.5*e.height,f+=.5*e.height):(c+=e.width,f+=e.height),a.x>=b&&a.x<=c&&a.y>=d&&a.y<=f},this.isDirty=function(){return f},this.asObject=function(){return $.extend({},this)},this.setPosition=function(a){CanvasEngine.utilities.exists(a.x)&&(this.x=a.x),CanvasEngine.utilities.exists(a.y)&&(this.y=a.y)},this.resize=function(a){CanvasEngine.utilities.exists(a.height)&&(this.height=a.height),CanvasEngine.utilities.exists(a.width)&&(this.width=a.width)},void CanvasEngine.utilities.setProperties(this,b)):window.exit(b.name+": Renderer missing draw method. Be sure to pass a draw method when attaching a Renderer component.")};CanvasEngine.EntityManager.addComponent("Renderer",function(a,c){return new b(a,c)})}(),function(){var a=(CanvasEngine.EntityManager.properties,CanvasEngine.utilities,function(a,b){var c=a.spritesheet;this.getSprite=function(a){return c.getSprite(a)},this.sHeight=function(){return c.sHeight()},this.sWidth=function(){return c.sWidth()},this.source=function(){return c.source()},this.getEntity=function(){return b}});CanvasEngine.EntityManager.addComponent("SpriteSheet",function(b,c){return new a(b,c)})}(),function(){var a=CanvasEngine.EntityManager.properties,b=(CanvasEngine.utilities,function(b,c){var d="center",e="middle",f="normal",g="12pt",h="sans-serif",i="";Object.defineProperties(this,{align:a.defaultProperty(d,b.callback),baseline:a.defaultProperty(e,b.callback),text:a.defaultProperty(i,b.callback),font:{enumerable:!0,configurable:!1,get:function(){return f+" "+g+" "+h},set:function(a){var c=a.match(/(\d00|bold\D*|lighter|normal)/);f=null!==c?c[0]:f;var d=a.match(/(\d+(px)|\d+(em)|\d+(pt))/);g=null!==d?d[0]:g,h=a.replace(f,"").replace(g,"").trim(),b.callback()}}}),CanvasEngine.utilities.setProperties(this,b),this.getEntity=function(){return c},this.asObject=function(){return $.extend({},this)},this.setText=function(a){this.text=a}});CanvasEngine.EntityManager.addComponent("Text",function(a,c){return new b(a,c)},!0)}(),function(){var a=CanvasEngine.EntityManager.properties,b=CanvasEngine.utilities,c=function(c,d){var e=b.exists(c.tiles)?c.tiles:[],f={};Object.defineProperties(f,{
x:a.defaultProperty(0,c.onScroll),y:a.defaultProperty(0,c.onScroll)});var g={width:c.width,height:c.height},h=b.isFunction(c.onTileClick)?c.onTileClick:null;this.getEntity=function(){return d},this.scroll=function(a){var b=Math.round(a.x/g.width),c=Math.round(a.y/g.height);f.x+=b,f.y+=c},this.getVisibleTiles=function(a){if(0===g.height||0===g.width)return[];for(var b,c=[],d=0,h=f.y+Math.round(a.height/g.height),i=f.x+Math.round(a.width/g.width),j=f.y;h>j;j++){c[d]=[],b=0;for(var k=f.x;i>k;k++)c[d][b]=e[j][k],b++;d++}return c},this.pixelToTile=function(a){var c=Math.floor(a.y/g.height)+f.y,d=Math.floor(a.x/g.width);return b.exists(e[c])&&b.exists(e[c][d])?{tile:e[c][d],x:d*g.width,y:c*g.height,row:c,col:d}:void 0},this.TileClick=function(a){if(null!==h){var b=this.pixelToTile(a);h.call(b)}},this.setTile=function(a,c){b.exists(e[a.y][a.x])&&(e[a.y][a.x]=c)},this.getTileSize=function(){return $.extend({},g)}};CanvasEngine.EntityManager.addComponent("TileMap",function(a,b){return new c(a,b)})}(),function(){var a=CanvasEngine.utilities,b=function(b,c){var d=new Date,e=new Date,f=!0,g=a.isFunction(b.onElapsed)?b.onElapsed:null,h=a.isFunction(b.onUpdate)?b.onUpdate:null,i=a.exists(b.duration)?b.duration:0,j=d.getDate()+i;this.update=function(){f&&(e=d,d=new Date,a.isFunction(g)&&i>0&&this.getMS()>=j&&(g(this.deltaTime),j=this.getMS()+i),a.isFunction(h)&&h(this.deltaTime()))},this.getMS=function(){return d.getTime()},this.getS=function(){return Math.round(d.getTime/1e3)},this.deltaTime=function(){return(d.getTime()-e.getTime())/1e3},this.getEntity=function(){return c},this.disable=function(){f=!1},this.enable=function(){f=!0,this.update()}};CanvasEngine.EntityManager.addComponent("Timer",function(a,c){return new b(a,c)},!0)}();
//# sourceMappingURL=cengine.min.js.map