<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: engineParts/Screen.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: engineParts/Screen.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author Steven Chennault &lt;schenn@gmail.com>
 *
 */
/**
 * @typedef {{
 *  offsetX: number,
 *  offsetY: number,
 *  cancelBubble: boolean,
 *  stopPropagation: function
 * }} LocalParams~mouseEventParams
 */

/**
 * Create and attach the Screen to the CanvasEngine
 */
(function(CanvasEngine){

  var previousMousePosition;

  /**
   * The Screen class manages the individual canvases of the Engine
   *
   * @class
   * @memberOf CanvasEngine
   */
  var Screen = function(){
    var canvases = [];
    var baseCanvas;

    /**
     * Get the height of the drawing area
     * @returns {number}
     */
    this.height = function(){
      return baseCanvas.height();
    };

    /**
     * Get the width of the drawing area
     * @returns {number}
     */
    this.width = function(){
      return baseCanvas.width();
    };

    /**
     * Set the base canvas which forms the back of the screen.
     *
     * @param {jQuery | HTMLElement} canvas A jQuery wrapped canvas
     */
    this.setScreen = function(canvas){
      if(!(canvas instanceof jQuery)){
        canvas = $(canvas);
      }
      canvases[0] = canvas;
      baseCanvas = canvas;
      baseCanvas.parent().on({
        click:this.onClick,
        mousedown: this.onMouseDown,
        mouseup:this.onMouseUp,
        mousemove: this.onMouseMove
      }, "canvas");
    };

    /**
     * Fill the parent container up to a given modifier.
     * @param {number} modifier A percentage 1 - 100
     */
    this.maximize = function(modifier){
      canvases.forEach(function(canvas){
        canvas.maximize(modifier);
      });
    };

    /**
     * Set the Screen Resolution.
     *
     * If you know what resolution your animation looks best at;
     *  Set it with this method and use CSS to scale the view.
     *  Be sure to maintain your aspect ratio in your style adjustments.
     *
     * @param {number} width
     * @param {number} height
     */
    this.setResolution = function(width, height){
      $.each(canvases, function(index, canvas){
        canvas.attr("width", width);
        canvas.attr("height", height);
      });
    };

    /**
     * Add a z layer (canvas) to the screen.
     *
     * @param {number} z The z index to add
     */
    this.addZLayer = function(z){
      if(CanvasEngine.utilities.exists(canvases[z])) return;

      // Set reference to the canvas element, not its jQuery wrapped version.
      // We only need reference to the base canvas in the screen as a fixed jQuery wrapped object.
      canvases[z] = baseCanvas.addZLayer(
        baseCanvas.attr("height"),
        baseCanvas.attr("width"),
        z
      );
    };

    /**
     * Remove a z layer from the Screen.
     *    You cannot remove the base canvas.
     *
     * @param {number} z The index to remove.
     */
    this.removeZLayer = function(z){
      if(z > 0) {
        canvases[z].remove();
        delete canvases[z];
        canvases = CanvasEngine.utilities.cleanArray(canvases);
      }
    };

    /**
     * Draw the Screen Stack
     *  - For each Screen Layer, get the enhanced context and tell CanvasEngine to draw the current Z layer
     *
     *  @see{@link CanvasEngine.drawZ}
     */
    this.drawScreen = function(){
      canvases.forEach(function(canvas, z){
        var ctx = canvas.getEnhancedContext();

        CanvasEngine.drawZ(z, ctx);
      });
    };

    /**
     * Clear an entity from the game screen.
     * @param {CanvasEngine.Entities#Entity} entity
     */
    this.clear = function(entity){
      var ctx = canvases[entity.z_index].getEnhancedContext();
      entity.messageToComponent("Renderer", "clear", ctx);
    };

    /**
     * Get the pixel data of a given position
     *
     * @param {number} x The x position of the pixel
     * @param {number} y The y position of the pixel
     * @param {number} h The height of the search area
     * @param {number} w The width of the search area
     * @param {number} transparent Flag to only check for transparent pixels
     *
     * @returns {Array}
     */
    this.atPixel = function(x, y, h, w, transparent){
      var pixelHits = [];
      var zs = Object.keys(canvases);

      // For each canvas
      $.each(zs, function(index, zIndex){
        // Ask the canvas if it has a solid pixel at that location
        if(canvases[zIndex].getEnhancedContext().atPixel(x, y, h, w, transparent)){
          pixelHits[zIndex] = true;
        }
        // If so, collect it.
      });
      return pixelHits;
    };

    /**
     * When a screen is clicked, collect the click coordinate and pass it to the CanvasEngine
     *
     * @param {LocalParams~mouseEventParams} e The click event
     *
     */
    this.onClick = function(e){
      e.stopPropagation();
      e.cancelBubble = true;
      var coords = {
        x: e.offsetX,
        y: e.offsetY
      };
      CanvasEngine.mouse(coords, "Click");
    };

    /**
     * When the mouse is moved over the canvas
     *
     * @param {LocalParams~mouseEventParams} e
     */
    this.onMouseMove = function(e){
      e.stopPropagation();
      e.cancelBubble = true;
      var coords = {
        x: e.offsetX,
        y: e.offsetY
      };
      CanvasEngine.mouse(coords, "MouseMove", previousMousePosition);
      previousMousePosition = coords;
    };

    /**
     * When a mouse button is pressed over the canvas
     *
     * @param {LocalParams~mouseEventParams} e
     */
    this.onMouseDown = function(e){
      e.stopPropagation();
      e.cancelBubble = true;
      var coords = {
        x: e.offsetX,
        y: e.offsetY
      };
      CanvasEngine.mouse(coords, "MouseDown");
    };

    /**
     * When a mouse button is released over the canvas
     *
     * @param {LocalParams~mouseEventParams} e
     */
    this.onMouseUp = function(e){
      e.stopPropagation();
      e.cancelBubble = true;
      var coords = {
        x: e.offsetX,
        y: e.offsetY
      };
      CanvasEngine.mouse(coords, "MouseUp");
    };

    /**
     * Capture a screenshot
     *
     * This method draws the stack of canvases to a single canvas.
     *  Then it converts that images into a base64 and sets it as an anchor tag ref with a download attribute
     *  Then it triggers a click onto that anchor tag, before removing it.
     *  This triggers the browser to (usually) perform a save-as for the image with the filename of the download attribute.
     */
    this.capture = function(){
      // Create a hidden canvas of the appropriate size
      var output = $("&lt;canvas>&lt;canvas>");
      output.attr("height", baseCanvas.height);
      output.attr("width", baseCanvas.width);
      output.hide();

      var ctx = output.getContext("2d");

      // Draw each canvas to the hidden canvas in order of z index
      for(var z=0; z &lt; canvases.length; z++){
        ctx.drawImage(canvases[i], 0, 0);
      }

      // Get the image data
      var dataUrl = output.toDataURL();

      // Save the image as a png
      var a = $("&lt;a>&lt;/a>");
      a.attr("href", dataUrl);
      a.attr("download", "ScreenShot"+(new Date().getDate())+".png");
      $("body").append(a);
      a.click();
      a.remove();
    };
  };

  // Attach The Screen manager to the CanvasEngine.
  CanvasEngine.Screen = new Screen();
})(window.CanvasEngine);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Externals</h3><ul><li><a href="external-jQuery.html">jQuery</a></li></ul><h3>Classes</h3><ul><li><a href="Canvas.enhancedContext.html">enhancedContext</a></li><li><a href="CanvasEngine.Components.Image.html">Image</a></li><li><a href="CanvasEngine.Components.KeyPress.html">KeyPress</a></li><li><a href="CanvasEngine.Components.Mouse.html">Mouse</a></li><li><a href="CanvasEngine.Components.Movement.html">Movement</a></li><li><a href="CanvasEngine.Components.PointPlotter.html">PointPlotter</a></li><li><a href="CanvasEngine.Components.Renderer.html">Renderer</a></li><li><a href="CanvasEngine.Components.SpriteSheet.html">SpriteSheet</a></li><li><a href="CanvasEngine.Components.Text.html">Text</a></li><li><a href="CanvasEngine.Components.TileMap.html">TileMap</a></li><li><a href="CanvasEngine.Components.TileMap_TileClick.html">TileClick</a></li><li><a href="CanvasEngine.Components.Timer.html">Timer</a></li><li><a href="CanvasEngine.Entities.AnimatedSprite.html">AnimatedSprite</a></li><li><a href="CanvasEngine.Entities.Animator.html">Animator</a></li><li><a href="CanvasEngine.Entities.Button.html">Button</a></li><li><a href="CanvasEngine.Entities.Entity.html">Entity</a></li><li><a href="CanvasEngine.Entities.Image.html">Image</a></li><li><a href="CanvasEngine.Entities.Line.html">Line</a></li><li><a href="CanvasEngine.Entities.MobileSprite.html">MobileSprite</a></li><li><a href="CanvasEngine.Entities.Rect.html">Rect</a></li><li><a href="CanvasEngine.Entities.Sprite.html">Sprite</a></li><li><a href="CanvasEngine.Entities.TileMap.html">TileMap</a></li><li><a href="CanvasEngine.Resources.SpriteSheet.html">SpriteSheet</a></li><li><a href="CanvasEngine.Screen.html">Screen</a></li><li><a href="CanvasEngine-EntityManager.html">EntityManager</a></li><li><a href="CanvasEngine-EntityManager.baseEntity.html">baseEntity</a></li><li><a href="CanvasEngine-EntityTracker.html">EntityTracker</a></li><li><a href="CanvasEngine-resourceManager.html">resourceManager</a></li></ul><h3>Events</h3><ul><li><a href="keyboard.html#event:keypress">keypress</a></li></ul><h3>Namespaces</h3><ul><li><a href="Callbacks.html">Callbacks</a></li><li><a href="Canvas.html">Canvas</a></li><li><a href="CanvasEngine.html">CanvasEngine</a></li><li><a href="CanvasEngine.Components.html">Components</a></li><li><a href="CanvasEngine.Entities.html">Entities</a></li><li><a href="CanvasEngine.Properties.html">Properties</a></li><li><a href="CanvasEngine.Resources.html">Resources</a></li><li><a href="CanvasEngine%250A%250AA%2520collection%2520of%2520utility%2520functions.utilities.html">utilities</a></li><li><a href="external-jQuery.fn.html">fn</a></li><li><a href="GeneralTypes.html">GeneralTypes</a></li><li><a href="keyboard.html">keyboard</a></li><li><a href="LocalParams.html">LocalParams</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Jun 02 2016 00:41:14 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
